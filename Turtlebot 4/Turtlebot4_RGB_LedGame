import rclpy
from rclpy.node import Node
from irobot_create_msgs.msg import LightringLeds, LedColor
from turtlebot4_msgs.msg import UserLed
from oslo_log import log as logging
from iotronic_lightningrod.modules.plugins import Plugin


class LedGame(Node):
    def __init__(self):
        super().__init__('led_game')
        self.pub = self.create_publisher(UserLed, '/hmi/led', 10)

        while (True):
            msg1 = UserLed(
                led=UserLed.USER_LED_1,
                color=UserLed.COLOR_RED,
                blink_period=1000,
                duty_cycle=1.0
            )
            self.pub.publish(msg1)
            self._on = False

            color = UserLed.COLOR_GREEN if self._on else UserLed.COLOR_OFF
            msg2 = UserLed(
                led=UserLed.USER_LED_2,
                color=color,
                blink_period=1000,
                duty_cycle=1.0
            )
            self.pub.publish(msg2)
            self.get_logger().info(f'LED_2 -> {"GREEN" if self._on else "OFF"}')
            self._on = not self._on

LOG = logging.getLogger(__name__)

def log_info(msg):
    try:
        LOG.info(msg)
    except Exception:
        print("[INFO]", msg)

def log_error(msg):
    try:
        LOG.error(msg)
    except Exception:
        print("[ERROR]", msg)


class Worker(Plugin.Plugin):
    def __init__(self, uuid, name, q_result=None, params=None):
        super(Worker, self).__init__(uuid, name, q_result, params)

    def run(self):
        rclpy.init()
        node = LedGame()
        try:
            rclpy.spin(node)
        except Exception as e:
            LOG.error('Error occurred while spinning node: %s', e)
        finally:
            self.stop()

